# stepik-flask-teachers
Решение заданий четвертой главы курса "Flask с нуля".

Приложение для своей работы использует следующие переменные окружения:

- `SECRET_KEY` - секретный ключ, используемый для безопасности сессий.
- `APP_STATIC_DIR` - путь к статическим файлам приложения, должен изменяться только в случае нестандартного расположения статических файлов при деплое приложения.
- `APP_DATA_VENDOR` - посставщик данных в программе. Может принимать занчения `sqlite` - если данные хранятся в базе данных SQLite и `postgresql` - если данные хранятся в базе данных PostgreSQL. Данная настройка имеет смысл, только если не установлено значение переменной окружения `DATABASE_URL`.
- `APP_DATABASE_FILE` - имя файла базы данных в случае, если значение переменной `APP_DATA_VENDOR` равно `sqlite`. По умолчанию файл базы данных будет иметь имя **data.db** и располатаься в той же папке, что и файл **manage.py**. Данная настройка имеет смысл, только если не установлено значение переменной окружения `DATABASE_URL`.
- `APP_DATABASE_HOST` - имя или адрес хоста сервера баз данных в случае, если значение переменной `APP_DATA_VENDOR` равно `postgresql`. По умолчанию эта настройка принимает значение `127.0.0.1`. Данная настройка имеет смысл, только если не установлено значение переменной окружения `DATABASE_URL`.
- `APP_DATABASE_PORT` - номер порта сервера баз данных в случае, если значение переменной `APP_DATA_VENDOR` равно `postgresql`. По умолчанию эта настройка принимает значение `5432`. Данная настройка имеет смысл, только если не установлено значение переменной окружения `DATABASE_URL`.
- `APP_DATABASE_NAME` - имя базы данных в случае, если значение переменной `APP_DATA_VENDOR` равно `postgresql`. По умолчанию эта настройка принимает значение `127.0.0.1`. Данная настройка имеет смысл, только если не установлено значение переменной окружения `DATABASE_URL`.
- `APP_DATABASE_USER` - имя пользователя базы данных в случае, если значение переменной `APP_DATA_VENDOR` равно `postgresql`. По умолчанию эта настройка принимает пустое значение. Данная настройка имеет смысл, только если не установлено значение переменной окружения `DATABASE_URL`.
- `APP_DATABASE_PASSWORD` - пароль пользователя базы данных в случае, если значение переменной `APP_DATA_VENDOR` равно `postgresql`. По умолчанию эта настройка принимает пустое значение. Данная настройка имеет смысл, только если не установлено значение переменной окружения `DATABASE_URL`.

Перед запуском проложения в случае использования PostgreSQL необходимо удостовериться в том, что база данных имя которой задано в переменных окружения `APP_DATABASE_NAME` или `DATABASE_URL` существует и она пуста.

После чего необходимо выполнить команду для запуска миграций применительно к выбранной базе данных:
```shell script
$ python -m flask db upgrade
``` 

При проверке для заполнения базы данных фейковыми значениями необходимо выполнить команду:
```shell script
$ python -m flask data add
```

Для удаления фейковых данных необходимо ввести команду:
```shell script
$ python -m flask data remove
```

При деплое в **Docker** необходимо сначала создать том, в котором будет располагаться файл хранилища, посредством команды:
```shell script
$ docker volume stepik_flask_teachers_data
```

Далее необходимо построить контейнеры с помощью команды
```shell script
$ docker-compose build
```
и выполнить запуск приложения
```shell script
$ docker-compose up
```

При первом запуске необходимо выполнить команду запуска миграций:
```shell script
$ docker-compose exec web python -m flask db upgrade
```

после чего можно выполнить заполнение базы данных приложения с помощью:
```shell script
$ docker-compose exec web python -m flask data add
```

В результате данное приложение будет доступно посредством порта 8080.

При деплое на **Heroku** после создания приложения и связи его с GitHub необходимо установить значения переменных конфигурации, так как там изначально присутствует переменная `DATABASE_URL` с некоторым значением, то устанавливать значения переменных приложения для связи с базой данных не нужно.

После настройки конфигурации необходимо выполнить в командной строке следующую команду для применения миграций к базе данных:
```shell script
$ heroku run python -m flask db upgrade --app=<имя приложения>
```

Для заполнения базы данных нужно выполнить команду:
```shell script
$ heroku run pythom -m flask data add --app=<имя приложения>
```

После чего требуется выполнить перезапуск приложения Heroku:
```shell script
$ heroku restart --app=<имя приложения>
```

*Примечание*: Вместо модели "Бронироване" в программе используется модель "Ячейка таблицы расписания" (`TimeTableCell`), которая выполняет те же функции. Вместо привязки ко дням недели в приложении выполнена привязка к датам, поэтому каждую неделю расписание преподавателя будет обновляться.