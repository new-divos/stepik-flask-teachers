# stepik-flask-tutors
Решение заданий третьей главы курса "Flask с нуля".

Приложение для своей работы использует следующие переменные окружения:

- `SECRET_KEY` - секретный ключ, используемый для безопасности сессий.
- `APP_STATIC_DIR` - путь к статическим файлам приложения, должен изменяться только в случае нестандартного расположения статических файлов при деплое приложения.
- `APP_STORAGE_LOCATION` - способ размещения файла данных. Может принимать только два значения: `local` - в этом случае файл данных располагается в файловой системе сервера приложения и `s3` - в этом случае будет размещен в бакете Amazon Web Services (AWS) S3.
- `APP_STORAGE_FILE` - наименование файла хранилища, по умолчанию **data.json**.
- `APP_STORAGE_DIR` - полный путь к папке, в которой будет расположен файл хранилища, имя которого находится в переменной `APP_STORAGE_FILE`. Эта настройка имеет смысл только если значение переменной `APP_STORAGE_LOCATION` равно `local`.
- `APP_STORAGE_S3_REGION` - идентификатор региона AWS S3, в датацентре которого будет находиться бакет AWS S3. Эта настройка имеет смысл только если значение переменной `APP_STORAGE_LOCATION` равно `s3`.
- `APP_STORAGE_S3_BUCKET` - наименование бакета AWS S3, в котором будет находится файл хранилища. Эта настройка имеет смысл только если значение переменной `APP_STORAGE_LOCATION` равно `s3`.
- `APP_STORAGE_S3_ACCESS_KEY_ID` - access key пользователя AWS S3. Эта настройка имеет смысл только если значение переменной `APP_STORAGE_LOCATION` равно `s3`.
- `APP_STORAGE_S3_SECRET_KEY_ID` - secret key пользователя AWS S3. Эта настройка имеет смысл только если значение переменной `APP_STORAGE_LOCATION` равно `s3`.

Перед запуском приложения необходимо создать хранилище посредством запуска команды:
```shell script
$ python manage.py create_storage
```

При деплое в Docker необходимо сначала создать том, в котором будет располагаться файл хранилища, посредством команды:
```shell script
$ docker volume create stepik_flask_tutors_data
```

Затем в той же директории, что и файл **docker-compose.yml** необходимо создать тестовый файл **.env.prod**, в котором необходимо установить значение переменной окружения `SECRET_KEY`, например, следующим образом:
```.env
SECRET_KEY=69e565bafc45286abe4046fdc579c60fe652a20cddae4f9389e5ea52800fc22f
```

Далее необходимо построить контейнеры с помощью команды
```shell script
$ docker-compose build
```
и выполнить запуск приложения
```shell script
$ docker-compose up
```

При первом запуске необходимо создать хранилище посредством запуска команды:
```shell script
$ docker-compose exec web python manage.py create_storage
```

После чего данное приложение будет доступно посредством порта 8080.

Завершить работу с контейнерами Docker можно с помощью команды:
```shell script
$ docker-compose down
```

При деплое приложения на **Heroku** значение переменной окружения `APP_STORAGE_LOCATION` всегда должно быть установлено в `s3`. При этом само хранилище в этом случае может быть созданно на локальной машине без выполнения скрипта на Heroku посредством ранее показанной команды.